<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
      crossorigin="anonymous"
    />

    <style>
      .print-format table th,
      .print-format table td {
        vertical-align: middle !important;
        border: 1px solid #3c3c3c !important;
      }
    </style>
  </head>

  <body>
    <div class="container-fluid">
      <div>
        <div><strong>Đơn vị: </strong> {%= filters.company_name %}</div>
        <div><strong>Địa chỉ: </strong> {%= filters.company_address %}</div>
        <div><strong>MST: </strong> {%= filters.tax_id %}</div>
      </div>

      <h5 class="fw-bold text-center">BÁO CÁO TỔNG HỢP CÔNG NỢ</h5>
      <h6 class="text-center">
        <!-- prettier-ignore -->
        {% let from_date = frappe.datetime.str_to_user(filters.from_date).split('-').join('/') %}
        {% let to_date = frappe.datetime.str_to_user(filters.to_date).split('-').join('/') %}
        Từ ngày {%= from_date %} đến {%= to_date %}
      </h6>

      <table class="table table-bordered">
        <thead>
          <tr class="fw-bold text-center">
            <th class="fw-bold" rowspan="2">Đơn vị</th>
            <th class="fw-bold" rowspan="2">Nhóm khách hàng</th>
            <th class="fw-bold" rowspan="2">Mã đối tượng</th>
            <th class="fw-bold" rowspan="2">Tên đối tượng</th>
            <th class="fw-bold" rowspan="2">Đơn vị tiền</th>
            <th class="fw-bold" rowspan="2">Tài khoản</th>
            <th class="fw-bold" colspan="2">Đầu kỳ</th>
            <th class="fw-bold" colspan="2">Phát sinh</th>
            <th class="fw-bold" colspan="2">Cuối kỳ</th>
          </tr>
          <tr class="text-center">
            <th class="fw-bold">Nợ</th>
            <th class="fw-bold">Có</th>
            <th class="fw-bold">Nợ</th>
            <th class="fw-bold">Có</th>
            <th class="fw-bold">Nợ</th>
            <th class="fw-bold">Có</th>
          </tr>
        </thead>
        <tbody>
          <!-- prettier-ignore -->
          {% for row in data %}
          {% const num_values = [row.opening_debit, row.opening_credit, row.arising_debit, row.arising_credit, row.closing_debit, row.closing_credit]; %}
          {% if (row.party_group && !row.party_name && num_values.some(val => val !== 0)) { %}
          <tr class="fw-bold">
            <td class="text-center bg-info-subtle" colspan="4">{{ row.party_group }}</td>
            <td class="text-center bg-info-subtle">{{ row.currency }}</td>
            <td class="bg-info-subtle"></td>
            <td class="text-right bg-info-subtle">{{ format_number_js(row.opening_debit) }}</td>
            <td class="text-right bg-info-subtle">{{ format_number_js(row.opening_credit) }}</td>
            <td class="text-right bg-info-subtle">{{ format_number_js(row.arising_debit) }}</td>
            <td class="text-right bg-info-subtle">{{ format_number_js(row.arising_credit) }}</td>
            <td class="text-right bg-info-subtle">{{ format_number_js(row.closing_debit) }}</td>
            <td class="text-right bg-info-subtle">{{ format_number_js(row.closing_credit) }}</td>
          </tr>
          {% } else if (row.party_name && row.party_name !== 'Tổng cộng') { %}
          <tr>
            <td>{{ row.branch }}</td>
            <td>{{ row.party_group }}</td>
            <td>{{ row.party_code }}</td>
            <td>{{ row.party_name }}</td>
            <td class="text-center">{{ row.currency }}</td>
            <td class="text-center">{{ row.account }}</td>
            <td class="text-right">{{ format_number_js(row.opening_debit) }}</td>
            <td class="text-right">{{ format_number_js(row.opening_credit) }}</td>
            <td class="text-right">{{ format_number_js(row.arising_debit) }}</td>
            <td class="text-right">{{ format_number_js(row.arising_credit) }}</td>
            <td class="text-right">{{ format_number_js(row.closing_debit) }}</td>
            <td class="text-right">{{ format_number_js(row.closing_credit) }}</td>
          </tr>
          {% } else if (row.party_name === 'Tổng cộng' && row.currency === 'VND') { %}
          <tr class="fw-bold">
            <td class="text-center bg-dark-subtle" colspan="4">Tổng cộng</td>
            <td class="text-center bg-dark-subtle">VND</td>
            <td class="bg-dark-subtle"></td>
            <td class="text-right bg-dark-subtle">{{ format_number_js(row.opening_debit) }}</td>
            <td class="text-right bg-dark-subtle">{{ format_number_js(row.opening_credit) }}</td>
            <td class="text-right bg-dark-subtle">{{ format_number_js(row.arising_debit) }}</td>
            <td class="text-right bg-dark-subtle">{{ format_number_js(row.arising_credit) }}</td>
            <td class="text-right bg-dark-subtle">{{ format_number_js(row.closing_debit) }}</td>
            <td class="text-right bg-dark-subtle">{{ format_number_js(row.closing_credit) }}</td>
          </tr>
          {% } else if (row.party_name === 'Tổng cộng' && row.currency === 'USD') { %}
          <tr class="fw-bold">
            <td class="text-center bg-dark-subtle" colspan="4">Tổng cộng</td>
            <td class="text-center bg-dark-subtle">USD</td>
            <td class="bg-dark-subtle"></td>
            <td class="text-right bg-dark-subtle">{{ format_number_js(row.opening_debit) }}</td>
            <td class="text-right bg-dark-subtle">{{ format_number_js(row.opening_credit) }}</td>
            <td class="text-right bg-dark-subtle">{{ format_number_js(row.arising_debit) }}</td>
            <td class="text-right bg-dark-subtle">{{ format_number_js(row.arising_credit) }}</td>
            <td class="text-right bg-dark-subtle">{{ format_number_js(row.closing_debit) }}</td>
            <td class="text-right bg-dark-subtle">{{ format_number_js(row.closing_credit) }}</td>
          </tr>
          {% } %} {% endfor %}
        </tbody>
      </table>

      <div class="row">
        <div class="col-4 ms-auto text-center">
          <!-- prettier-ignore -->
          {% let day = new Date().getDate() %}
          {% let month = new Date().getMonth() + 1 %}
          {% let year = new Date().getFullYear() %}
          Ngày {%= day %} tháng {%= month %} năm {%= year %}
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-4 text-center">
          <p><strong>Người lập biểu</strong></p>
          <p><i>(Chữ ký, họ tên)</i></p>
        </div>
        <div class="col-4 text-center">
          <p><strong>Phụ trách kế toán</strong></p>
          <p><i>(Chữ ký, họ tên)</i></p>
        </div>
        <div class="col-4 text-center">
          <p><strong>Thủ trưởng đơn vị</strong></p>
          <p><i>(Chữ ký, họ tên, đóng dấu)</i></p>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
